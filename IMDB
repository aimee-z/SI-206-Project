import sqlite3
import os
import matplotlib.pyplot as plt 
import numpy as np
import unittest
import json
import requests
import pandas as pd

## Team Name: Women in Stem  
## Team Members: Aimee Zheng, Sage Pei, Marina Sun

#Scope: Relationship between IMDB top 100 ranked movies, iTunes data for that movie (esp cost to rent/buy),
# and OMDB data (box office, awards - how do these line up with IMDB top 100 movie rankings)


# Create project database
def setUpDatabase(db_name):
    path = os.path.dirname(os.path.abspath(__file__))
    conn = sqlite3.connect(path+'/'+db_name)
    cur = conn.cursor()
    return cur, conn

#get IMDB API 
def IMDB_api():
    #request for top IMDB movies 
    api_key = 'k_a25gd810'
    api_result = requests.get('https://imdb-api.com/en/API/Top250Movies/k_a25gd810')
    data = api_result.json()
    return data
    #print(data)

#create IMDB table
def IMDB_table(data, cur, conn):
    cur.execute('DROP TABLE IF EXISTS "IMDB Data"')
    cur.execute('CREATE TABLE "IMDB Data"("Id"INTEGER PRIMARY KEY, "rank" INTEGER,"title" TEXT, "imDbRating" INTEGER)')
    
    newdata = data 
    count = 1 
    for i in newdata['items']: 
        Id = count
        rank = i['rank']
        title = i['title']
        imDbRating = i['imDbRating']
        cur.execute('INSERT INTO "IMDB Data"(Id,rank,title,imDbRating) VALUES (?,?,?,?)',(Id, rank, title,imDbRating))
        count = count + 1 
    conn.commit()

    